---
title: "R Notebook"
output: html_notebook
---
 

```{r}
# clean up workspace environment
rm(list = ls())

# all packages used for the assignment
library(DataComputing)
library(tidyr)
library(readr)
library(dplyr)
library(ggmap)
library(party)
library(rpart)
library(reticulate)
py_discover_config()
# Read the NMC data in.
NMC<-readr::read_csv("NMC_5_0.csv")

# Read the World Bank Data
WBD <- readr::read_csv("wbd.csv")

# Inspect the data
head(NMC)
head(WBD)

nrow(NMC)
nrow(WBD)
```
## Select only the important variables from World Bank that we care about. Note that GDP is in USD. And that year only goes up to 2012 in NMC, select until then.
```{python}
# Use Python to return us a list of column names from 1960 to 2012 in string format so that we can wrangle our data easier down below. Note that the for loop ends one year higher, becasue python uses the stop at for method.
selectionList = ["Country Name", "Country Code"]
for currentDate in range (1960, 2013):
  selectionList.append(str(currentDate))
```

```{r}
# Pass the selection list from our Python enviroment, and save it as a vecorized list "c()" in out R enviroment
# Use the py$ when we find out why is doesn't work.


WBD <-
  WBD %>%
  select('Country Code', '1960', '1961', '1962', '1963', '1964', '1965', '1966', '1967', '1968', '1969', '1970', '1971', '1972', '1973', '1974', '1975', '1976', '1977', '1978', '1979', '1980', '1981', '1982', '1983', '1984', '1985', '1986', '1987', '1988', '1989', '1990', '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012')

head(WBD)

```

```{r}
#Gather function to get WBD to the same narrow format as the NMC data
yearsAndGDP <-
  WBD %>%
  gather(key='Country Code', value = 'years')

yearsAndGDP

z<- WBD %>%
  gather(key = "raw", value = "CountryCodes") %>%
  select(CountryCodes)

yearsAndGDP %>%
  mutate(z)


```


```{r}
NMC %>%
  filter(stateabb %in% c("USA", "CHN") & year > "1950") %>%
  select(stateabb, year, cinc) %>%
  ggplot(aes(x=year, y=cinc, color = stateabb)) +
  geom_point() +
  stat_smooth() +
  ylab("Year of Measure") +
  xlab("Composite Index of National Capabilities")

```

Find the average military expenditure of countries since from the beginning of the dataset. Notice that there are spikes in military expenditure during WWI (1917), US joins WWII (1941) (growth in milex grows rapidly each year after), Begining of Vietnam War (1955), Peak of cold war and local minima after fall of USSR (1993), attacks on Sept. 11 2001 (2002 budgetary information). This demonstrates that everytime the United States' entered a war, it has had a direct impact on the average military expenditure of the world. 
```{r}
NMC %>%
  select(stateabb, year, milex) %>%
  group_by(year) %>%
  summarise(avg_Expenditure = mean(milex)) %>%
  ggplot(aes(x=year, y=avg_Expenditure)) +
  geom_point() +
  xlab("Year of Observation") +
  ylab("Military Expenditure In Billion of USD") +
  geom_vline(xintercept = 1917) +
  geom_vline(xintercept = 1941) +
  geom_vline(xintercept = 1955) +
  geom_vline(xintercept = 1993) +
  geom_vline(xintercept = 2002) 
  

```
Interestingly Enough if we run the same operation, except this time removing the United States, we can begin to notice that these verticle bars which have deeply rooted signifigance in the United States, begin to loose meaning, i.e. they are starting to move from peaks in the data; thus demonstrating the signifigance of impact the US has on the world military expenditures. NOTE: the y limit droped by a factor of 10^2 thousand dollars when we removed the United States!
```{r}
NMC %>%
  select(stateabb, year, milex) %>%
  filter(stateabb != "USA") %>%
  group_by(year) %>%
  summarise(avg_Expenditure = mean(milex)) %>%
  ggplot(aes(x=year, y=avg_Expenditure)) +
  geom_point() +
  xlab("Year of Observation") +
  ylab("Military Expenditure In Billion of USD") +
  geom_vline(xintercept = 1917) +
  geom_vline(xintercept = 1941) +
  geom_vline(xintercept = 1955) +
  geom_vline(xintercept = 1993) +
  geom_vline(xintercept = 2002)

```
```{r}
determineUSMilitaryExpenditure <- function(passedYear)
{
  
result<-
NMC %>%
  select(stateabb, milex, year) %>%
  filter(stateabb=="USA") %>%
  filter(year==passedYear) %>%
  select(milex)
  
return (result)  

}
```

Since 1993, there has been a spike in military expenditure in the United States. The difference between the expenditure of these two years in thosand U.S Dollars:
```{r}
year1993MilEx <- determineUSMilitaryExpenditure(1993)
year2012MilEx <- determineUSMilitaryExpenditure(2012)
(year2012MilEx - year1993MilEx)
```

Even though the military expenditure has went up over the course of that time, there is a strong negative association between the funds and military personelle. If a larger military expenditure does not mean more military personelle, than that leads us to question what we are spending our money on.
```{r}
milper<-
NMC%>%
  select(year, milper) %>%
  group_by(year) %>%
  summarise(milper=mean(milper)) %>%
  filter(year>=1993) %>%
  select(milper)

milex<-
NMC%>%
  select(year, milex) %>%
  group_by(year) %>%
  summarise(milex=mean(milex)) %>%
  filter(year>=1993) %>%
  select(milex)


cor(milex, milper, method = c("pearson"))
```

I'm curious to run a regression model to see the signifigance of all the six parts that have the most impact on CINC Score.
```{r}
head(NMC)
forModel <-
NMC %>%
  select(milex, milper, irst, pec, tpop, upop, cinc)

modLM <-
  lm(cinc ~ ., data = forModel)

modTree <-
  rpart::rpart(cinc ~ ., data = forModel)

summary(modLM)
prp(modTree)



```

